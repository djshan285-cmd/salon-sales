<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deruja Beauty Hub and Lounge â€” Dashboard</title>
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg-orbs"></div>

  <header class="topbar">
    <div class="topbar-left">
      <div class="topbar-logo">
        <!-- 72px logo requested -->
        <img src="assets/logo.png" alt="Logo" />
      </div>
      <div class="topbar-text">
        <div class="topbar-title">Deruja Beauty Hub and Lounge</div>
        <div class="topbar-sub">Daily Sales â€¢ Expenses â€¢ Monthly Payments</div>
      </div>
    </div>

    <div class="topbar-actions">
      <a class="btn btn-soft" href="reports.html" title="Reports">
        ðŸ“Š <span class="hide-sm">Reports</span>
      </a>
      <button id="logoutBtn" class="btn btn-danger" type="button">
        âŽ‹ <span class="hide-sm">Logout</span>
      </button>
    </div>
  </header>

  <main class="page">
    <section class="grid-2">
      <!-- Daily Sales -->
      <div class="glass-card card">
        <div class="card-head">
          <h2>Daily Sales</h2>
          <p>Enter daily totals + same-day expenses + bank saving</p>
        </div>

        <form id="dailyForm" class="form">
          <div class="grid-2-sm">
            <label class="field">
              <span>Date</span>
              <input id="dDate" type="date" required />
            </label>
            <label class="field">
              <span>Total sales</span>
              <input id="dBusiness" type="number" inputmode="decimal" step="0.01" placeholder="0.00" required />
            </label>
          </div>

          <label class="field">
            <span>Same-day expenses</span>
            <input id="dExpense" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
          </label>

          <label class="field">
            <span>Bank saving (same day)</span>
            <input id="dBank" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
          </label>

          <label class="field">
            <span>Note</span>
            <textarea id="dNote" rows="3" placeholder="Optional"></textarea>
          </label>

          <div class="btn-row">
            <button class="btn btn-primary" type="submit">Submit</button>
            <button id="dailyNew" class="btn btn-soft" type="button">New</button>
          </div>

          <p id="dailyMsg" class="msg"></p>
        </form>
      </div>

      <!-- Monthly Must -->
      <div class="glass-card card">
        <div class="card-head">
          <h2>Monthly Payments</h2>
          <p>Salaries / Rent / Water / Electric bills</p>
        </div>

        <form id="monthlyForm" class="form">
          <div class="grid-2-sm">
            <label class="field">
              <span>Month</span>
              <input id="mMonth" type="month" required />
            </label>

            <label class="field">
              <span>Type</span>
              <select id="mType" required>
                <option value="salary">Salaries</option>
                <option value="rent">Rent</option>
                <option value="water">Water</option>
                <option value="electric">Electric</option>
                <option value="other">Other</option>
              </select>
            </label>
          </div>

          <label class="field" id="workerWrap">
            <span>Worker name (only for Salaries)</span>
            <input id="mWorker" type="text" placeholder="Worker name" />
          </label>

          <div class="grid-2-sm">
            <label class="field">
              <span>Paid date</span>
              <input id="mPaidDate" type="date" required />
            </label>
            <label class="field">
              <span>Amount</span>
              <input id="mAmount" type="number" inputmode="decimal" step="0.01" placeholder="0.00" required />
            </label>
          </div>

          <label class="field">
            <span>Note</span>
            <textarea id="mNote" rows="3" placeholder="Optional"></textarea>
          </label>

          <div class="btn-row">
            <button class="btn btn-primary" type="submit">Submit</button>
            <button id="monthlyNew" class="btn btn-soft" type="button">New</button>
          </div>

          <p id="monthlyMsg" class="msg"></p>
        </form>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // âœ… YOUR CONFIG (kept exactly)
    const firebaseConfig = {
      apiKey: "AIzaSyB_pQt0C5X3R9tmVl8SRGT-DQ3eoNvdOEw",
      authDomain: "salonsales-32a19.firebaseapp.com",
      projectId: "salonsales-32a19",
      storageBucket: "salonsales-32a19.firebasestorage.app",
      messagingSenderId: "727392891815",
      appId: "1:727392891815:web:1ea28d2335b6ee9a363c82"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Collections (do not change unless your DB uses different names)
    const COL_DAILY = "dailySales";
    const COL_MONTHLY = "monthlyExpenses";

    const $ = (id) => document.getElementById(id);

    let currentUser = null;

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }
      currentUser = user;
    });

    $("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "index.html";
    });

    // Show worker field only if salary
    const mType = $("mType");
    const workerWrap = $("workerWrap");
    const mWorker = $("mWorker");

    function refreshWorkerVisibility() {
      const isSalary = mType.value === "salary";
      workerWrap.style.display = isSalary ? "block" : "none";
      if (!isSalary) mWorker.value = "";
    }
    mType.addEventListener("change", refreshWorkerVisibility);
    refreshWorkerVisibility();

    // Daily Form
    $("dailyNew").addEventListener("click", () => {
      $("dDate").value = "";
      $("dBusiness").value = "";
      $("dExpense").value = "";
      $("dBank").value = "";
      $("dNote").value = "";
      $("dailyMsg").textContent = "";
      $("dailyMsg").className = "msg";
    });

    $("dailyForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = $("dailyMsg");
      msg.className = "msg";
      msg.textContent = "";

      try {
        const payload = {
          uid: currentUser.uid,
          date: $("dDate").value, // YYYY-MM-DD
          business: Number($("dBusiness").value || 0),
          sameDayExpenses: Number($("dExpense").value || 0),
          bankSaving: Number($("dBank").value || 0),
          note: $("dNote").value.trim(),
          createdAt: serverTimestamp()
        };

        await addDoc(collection(db, COL_DAILY), payload);

        msg.className = "msg msg-ok";
        msg.textContent = "Saved âœ”";
      } catch (err) {
        msg.className = "msg msg-error";
        msg.textContent = err?.message || "Save failed";
      }
    });

    // Monthly Form
    $("monthlyNew").addEventListener("click", () => {
      $("mMonth").value = "";
      $("mType").value = "salary";
      $("mWorker").value = "";
      $("mPaidDate").value = "";
      $("mAmount").value = "";
      $("mNote").value = "";
      refreshWorkerVisibility();

      $("monthlyMsg").textContent = "";
      $("monthlyMsg").className = "msg";
    });

    $("monthlyForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = $("monthlyMsg");
      msg.className = "msg";
      msg.textContent = "";

      try {
        const monthKey = $("mMonth").value; // YYYY-MM
        const type = $("mType").value;
        const workerName = type === "salary" ? $("mWorker").value.trim() : "";

        const payload = {
          uid: currentUser.uid,
          monthKey,
          type,
          workerName,
          paidDate: $("mPaidDate").value, // YYYY-MM-DD
          amount: Number($("mAmount").value || 0),
          note: $("mNote").value.trim(),
          createdAt: serverTimestamp()
        };

        await addDoc(collection(db, COL_MONTHLY), payload);

        msg.className = "msg msg-ok";
        msg.textContent = "Saved âœ”";
      } catch (err) {
        msg.className = "msg msg-error";
        msg.textContent = err?.message || "Save failed";
      }
    });
  </script>
</body>
</html>
